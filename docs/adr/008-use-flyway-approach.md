# [ADR-008] Использование Flyway для миграций базы данных

**Status:** Proposed
**Date:** 2026-02-25

## Context
Нашему модульному монолиту требуется надежный инструмент для управления схемой базы данных PostgreSQL (создание таблиц, индексов, добавление колонок). Схема БД должна версионироваться вместе с кодом.
Так как мы используем R2DBC для реактивной работы с БД, инструмент миграций будет запускаться на этапе инициализации Spring Context через отдельное JDBC-соединение.

## Decision
Мы выбираем **Flyway** в качестве системы управления миграциями.
Миграции будут описываться в виде чистых SQL-скриптов с жестким версионированием (например, `V1__init_schema.sql`). Мы будем использовать стратегию "Roll forward" (исправление ошибок новыми скриптами), отказавшись от концепции автоматических даунгрейдов (откатов).

## Consequences
**Положительные:**
* **Простота и прозрачность:** Миграции пишутся на чистом, нативном SQL PostgreSQL. Разработчикам не нужно учить новый синтаксис (YAML/XML).
* **Контроль:** Мы точно знаем, какой именно SQL-код выполнится на сервере. Можно использовать любые специфичные фичи PostgreSQL (например, `JSONB` операторы или сложные индексы).
* **Скорость:** Инструмент легковесный, работает быстро и предсказуемо.

**Отрицательные:**
* **Отсутствие бесплатных откатов:** В бесплатной версии Flyway Community нет поддержки `Undo` скриптов (откаты доступны только в Teams версии).
* **Привязка к БД:** Скрипты жестко завязаны на синтаксис PostgreSQL. Сменить базу данных в будущем будет сложнее (хотя для нашего проекта это не планируется).
