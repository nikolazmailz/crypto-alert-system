## Git & Commits
Мы используем Conventional Commits. Это позволяет автоматически генерировать Changelog.\
Формат: <type>(<task>): <subject> \
Типы:
* feature: новая функциональность
* bugfix: исправление бага
* hotfix: исправление бага в продакшене
* chore: настройка сборки, обновление зависимостей (нет изменений в прод коде)
* docs: изменения в документации
* refactor: изменение кода без изменения поведения
* test: добавление тестов

## Работа с ветками:
main (или master):
* Священная корова.
* Здесь лежит только Production-ready код.
* Сюда попадает код только через Merge Request (MR/PR) из release или hotfix.
* На каждый коммит здесь вешается Tag (v1.0.0, v1.1.0).

develop:
* Наша основная рабочая ветка.
* Сюда сливаются завершенные фичи.
* Это код, который прошел тесты и ревью, но еще не ушел в релиз.

feature/... (Временные ветки):
* Ответвляются от: develop.
* Вливаются в: develop.
* Именование: feature/TASK-ID-short-description (например, feature/CAS-1-setup-gradle).

release/... (Временные ветки):
* Ответвляются от: develop (когда накопили фичи).
* Вливаются в: main и develop.
* Используются для стабилизации релиза (бамп версий, финальные правки документации).

hotfix/...:
* Если продакшн упал. Ответвляются от main.

## Workflow:

1.  **Sync:** Перед созданием ветки обнови `develop` (`git pull origin develop`).
2.  **Branch:** Создай ветку `feature/...`.
3.  **Work:** Пишим код.
4.  **Test:** Запусти `./gradlew test` и `./gradlew detekt`.
5.  **Push & MR:** Merge Request.
6.  **Review Fix:**
7.  **Clean History (Squash & Amend)**
8.  **Merge**

### Что такое git commit --amend
Amend (Дополнить) — это способ переписать самый последний коммит.
* Сценарий: Ты сделал коммит, но забыл добавить один файл, или допустил опечатку в сообщении коммита.
* Правило: Можно делать только если ты еще не запушил коммит (или если это твоя личная ветка, и ты готов сделать force push).

Как сделать в IntelliJ IDEA:
* Открой окно Commit.
* Внеси нужные изменения.
* Поставь галочку Amend.
* Старое сообщение коммита подтянется автоматически. Исправь его если нужно.
* Нажми Commit.
* Если уже был пуш в ветку, то надо делать push force

### Что такое Squash
Squash — это объединение нескольких коммитов в один.

Как сделать в IntelliJ IDEA (Interactive Rebase):\
Это самый мощный способ. Мы переписываем историю ветки локально перед тем, как отдать её на ревью или смерджить.
* Перейди на вкладку Git (внизу) -> Log.
* Найди в списке коммитов тот, от которого началась твоя ветка (например, последний коммит из develop).
* Нажми на него Правой Кнопкой Мыши -> Interactively Rebase from Here...
* Откроется окно:
* Оставь верхний коммит как Pick (это будет "голова" нового объединенного коммита).
* Все остальные коммиты ниже пометь как Squash (они вольются в верхний).
* Нажми Start Rebase.
* IDEA предложит объединить сообщения всех коммитов. Удали мусор, напиши одно красивое сообщение.

Squash через git:
* git rebase develop
* git rebase -i develop
* в файле все pick кроме верхнего поменять на s (squash)
* сохранить файл (в Vim это :wq и Enter).
* Сразу после этого откроется новое окно редактора. Git предложит тебе объединить сообщения всех коммитов.
* Удали лишний мусор и оставь одно красивое сообщение.
* Сохранить и закрыть файл.
* git push --force

### Быстрый трюк (Soft Reset):
* Делаем soft reset до ветки develop
* git reset --soft develop
* Что произойдет: Git отменит все коммиты, но сами изменения кода останутся в рабочей директории (они уже добавлены в git add).
* git commit -m "feat(task): implement new feature"
* git push --force-with-lease

## Релизный цикл (Release Branch)
Подготовка к выкатке новой версии.
**Алгоритм действий:**
1.  **Start:** Создаем ветку `release/v1.1.0` от `develop`.
  * С этого момента `develop` открыт для фич версии v1.2.0.
  * В `release/v1.1.0` новые фичи лить **ЗАПРЕЩЕНО**.

2.  **Bugfix Loop (Цикл исправлений):**
  * Если QA находит баг, фикс делается в ветке `release/v1.1.0`.
  * **ВАЖНО:** Любой фикс из релиза должен попасть в `develop`.
  * *Предпочтительный метод:* Сразу после мерджа фикса в релиз, делаем `git checkout develop && git merge --no-ff release/v1.1.0`. Решаем конфликты сразу.

3.  **Finish:**
  * Слияние в `main` (с тегом).
```bash
        git checkout main
        git merge --no-ff release/v1.1.0
        git tag -a v1.1.0 -m "Release v1.1.0"
        git push origin main --tags
```
  * Финальное слияние в `develop` (чтобы убедиться, что последние правки версии 1.1.0 доехали до будущей версии).
```bash
        git checkout develop
        git merge --no-ff release/v1.1.0
        git push origin develop
```
  * Удаление релизной ветки.

### Хотфиксы (Hotfix Workflow)
Экстренное исправление критического бага на продакшене.
**Алгоритм действий:**
1.  **Создание ветки:**
    `git checkout main`
    `git checkout -b hotfix/v1.1.1-fix-critical-npe`
2.  **Fix:** Исправление бага + добавление теста, который воспроизводит баг.
    * Бамп версии (Patch version: 1.1.0 -> 1.1.1).
3.  **Verify:** Локальный прогон тестов.
4.  **Merge:**
  * В `main`:
      ```bash
      git checkout main
      git merge --no-ff hotfix/v1.1.1-fix-critical-npe
      git tag -a v1.1.1 -m "Hotfix v1.1.1"
      git push origin main --tags
      ```
  * В `develop`:
      ```bash
      git checkout develop
      git merge --no-ff hotfix/v1.1.1-fix-critical-npe
      git push origin develop
      ```
5.  **Удаление ветки:** `git branch -d hotfix/v1.1.1...`
